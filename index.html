<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Energy Battle - Chaos Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #0f172a;
            color: white;
            overflow-x: hidden;
        }
        
        /* Neon Effects */
        .neon-text {
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.7), 0 0 20px rgba(56, 189, 248, 0.5);
        }
        .neon-chaos {
            text-shadow: 0 0 10px rgba(248, 113, 113, 0.9), 0 0 30px rgba(220, 38, 38, 0.8);
            animation: pulse-red 1s infinite alternate;
        }
        
        @keyframes pulse-red {
            from { text-shadow: 0 0 10px rgba(248, 113, 113, 0.9), 0 0 20px rgba(220, 38, 38, 0.6); }
            to { text-shadow: 0 0 20px rgba(248, 113, 113, 1), 0 0 40px rgba(220, 38, 38, 0.9); transform: scale(1.05); }
        }

        /* Animations */
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Chaos Background Animation */
        .chaos-bg {
            background: linear-gradient(45deg, #450a0a, #7f1d1d, #450a0a);
            background-size: 200% 200%;
            animation: gradientBG 3s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="bg-slate-900 min-h-screen flex flex-col">

    <!-- Header / Scoreboard -->
    <header class="bg-slate-800 border-b border-slate-700 p-4 sticky top-0 z-20 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-bold text-sky-400 neon-text uppercase tracking-wider">Physics Battle</h1>
                    <div id="progress-display" class="bg-slate-700 px-3 py-1 rounded text-sm text-slate-300">
                        ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà <span id="current-q-num">1</span> / 30
                    </div>
                </div>
                
                <div class="flex gap-4 w-full md:w-auto">
                    <!-- Team 1 -->
                    <div class="flex-1 md:w-40 bg-red-900/30 border border-red-500/50 rounded-lg p-2 text-center relative overflow-hidden transition-all" id="score-box-0">
                        <div class="absolute top-0 left-0 w-1 h-full bg-red-500"></div>
                        <div class="text-xs text-red-300 flex justify-between px-1">
                            <span>‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á</span>
                            <span id="hint-badge-0" class="text-yellow-400 text-[10px]">üí° ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢</span>
                        </div>
                        <div class="text-xl font-bold text-white" id="score-0">0</div>
                    </div>
                    <!-- Team 2 -->
                    <div class="flex-1 md:w-40 bg-blue-900/30 border border-blue-500/50 rounded-lg p-2 text-center relative overflow-hidden transition-all" id="score-box-1">
                        <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                        <div class="text-xs text-blue-300 flex justify-between px-1">
                            <span>‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô</span>
                            <span id="hint-badge-1" class="text-yellow-400 text-[10px]">üí° ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢</span>
                        </div>
                        <div class="text-xl font-bold text-white" id="score-1">0</div>
                    </div>
                    <!-- Team 3 -->
                    <div class="flex-1 md:w-40 bg-green-900/30 border border-green-500/50 rounded-lg p-2 text-center relative overflow-hidden transition-all" id="score-box-2">
                        <div class="absolute top-0 left-0 w-1 h-full bg-green-500"></div>
                        <div class="text-xs text-green-300 flex justify-between px-1">
                            <span>‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</span>
                            <span id="hint-badge-2" class="text-yellow-400 text-[10px]">üí° ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢</span>
                        </div>
                        <div class="text-xl font-bold text-white" id="score-2">0</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="flex-grow p-4 flex items-center justify-center relative overflow-hidden">
        
        <!-- Game Container -->
        <div id="game-container" class="w-full max-w-4xl relative z-10 hidden">
            
            <!-- Question Card -->
            <div class="bg-slate-800 border-2 border-slate-600 rounded-2xl shadow-2xl overflow-hidden slide-in" id="question-card">
                
                <!-- Timer Bar -->
                <div class="h-2 bg-slate-700 w-full">
                    <div id="timer-bar" class="h-full bg-gradient-to-r from-green-500 to-red-500 w-full transition-all duration-1000 ease-linear"></div>
                </div>

                <div class="p-6 md:p-10">
                    <!-- Top Info -->
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span id="q-category" class="inline-block py-1 px-3 rounded bg-sky-900/50 text-sky-400 text-sm font-bold tracking-wider mb-2 border border-sky-500/30">
                                CATEGORY
                            </span>
                            <div class="text-slate-400 text-sm">Level <span id="q-difficulty">1</span></div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-slate-400 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</div>
                            <div id="timer-text" class="text-5xl font-mono font-bold text-white tracking-widest">04:00</div>
                        </div>
                    </div>

                    <!-- Question Text -->
                    <div class="bg-slate-900/50 p-8 rounded-xl border border-slate-700 mb-4 min-h-[160px] flex flex-col items-center justify-center shadow-inner relative">
                        <p id="q-text" class="text-2xl md:text-3xl text-center text-white leading-relaxed font-light z-10">
                            ...
                        </p>
                        
                        <!-- Hint Display Area -->
                        <div id="hint-display" class="hidden mt-6 bg-yellow-900/40 border border-yellow-500/50 p-4 rounded-lg w-full text-center fade-in">
                            <div class="text-yellow-400 text-sm font-bold uppercase tracking-wider mb-1">üí° HINT / ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</div>
                            <div id="hint-content" class="text-xl text-white font-mono"></div>
                            <div id="hint-user" class="text-xs text-slate-400 mt-2">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢ ‡∏ó‡∏µ‡∏°...</div>
                        </div>
                    </div>

                    <!-- Interaction Area -->
                    <div id="interaction-area" class="space-y-6">
                        <!-- Input -->
                        <div class="flex justify-center">
                            <input type="number" id="answer-input" placeholder="‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç" 
                                class="bg-slate-900 border-2 border-slate-500 text-white text-4xl text-center rounded-xl py-4 px-8 w-full max-w-md focus:border-sky-500 focus:outline-none focus:ring-4 focus:ring-sky-500/20 transition-all placeholder-slate-600 shadow-lg">
                        </div>

                        <!-- Team Buttons & Helpers -->
                        <div>
                            <div class="text-center text-slate-400 text-sm mb-3">‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</div>
                            <div class="grid grid-cols-3 gap-4 md:gap-6">
                                <!-- Team 0 -->
                                <div class="flex flex-col gap-2">
                                    <button onclick="submitAnswer(0)" id="btn-team-0" class="py-4 md:py-6 rounded-xl bg-red-600 hover:bg-red-500 text-white font-bold text-xl shadow-lg shadow-red-900/50 transition-all active:scale-95 disabled:opacity-30 disabled:grayscale w-full">
                                        ‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á
                                    </button>
                                    <button onclick="useHint(0)" id="btn-hint-0" class="py-2 rounded-lg bg-slate-700 hover:bg-yellow-600 text-slate-300 hover:text-white text-sm transition-colors border border-slate-600 disabled:opacity-20 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                                        <span>üí° ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢</span>
                                    </button>
                                </div>
                                
                                <!-- Team 1 -->
                                <div class="flex flex-col gap-2">
                                    <button onclick="submitAnswer(1)" id="btn-team-1" class="py-4 md:py-6 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold text-xl shadow-lg shadow-blue-900/50 transition-all active:scale-95 disabled:opacity-30 disabled:grayscale w-full">
                                        ‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
                                    </button>
                                    <button onclick="useHint(1)" id="btn-hint-1" class="py-2 rounded-lg bg-slate-700 hover:bg-yellow-600 text-slate-300 hover:text-white text-sm transition-colors border border-slate-600 disabled:opacity-20 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                                        <span>üí° ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢</span>
                                    </button>
                                </div>

                                <!-- Team 2 -->
                                <div class="flex flex-col gap-2">
                                    <button onclick="submitAnswer(2)" id="btn-team-2" class="py-4 md:py-6 rounded-xl bg-green-600 hover:bg-green-500 text-white font-bold text-xl shadow-lg shadow-green-900/50 transition-all active:scale-95 disabled:opacity-30 disabled:grayscale w-full">
                                        ‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
                                    </button>
                                    <button onclick="useHint(2)" id="btn-hint-2" class="py-2 rounded-lg bg-slate-700 hover:bg-yellow-600 text-slate-300 hover:text-white text-sm transition-colors border border-slate-600 disabled:opacity-20 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                                        <span>üí° ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Next Button Area (Hidden initially) -->
                    <div id="next-area" class="hidden mt-8 text-center animate-bounce">
                        <button onclick="nextQuestion()" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white font-bold text-2xl py-4 px-12 rounded-full shadow-xl hover:scale-105 transition-transform border-4 border-white/20">
                            ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûî
                        </button>
                    </div>

                    <!-- Feedback -->
                    <div id="feedback-msg" class="hidden mt-6 text-center p-4 rounded-xl text-xl font-bold border-2"></div>
                </div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden w-full max-w-4xl text-center">
            <h2 class="text-5xl font-bold text-white mb-8 neon-text">‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô!</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-red-900/40 p-6 rounded-xl border border-red-500">
                    <div class="text-red-300 mb-2">‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á</div>
                    <div class="text-4xl font-bold text-white" id="final-score-0">0</div>
                </div>
                <div class="bg-blue-900/40 p-6 rounded-xl border border-blue-500">
                    <div class="text-blue-300 mb-2">‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <div class="text-4xl font-bold text-white" id="final-score-1">0</div>
                </div>
                <div class="bg-green-900/40 p-6 rounded-xl border border-green-500">
                    <div class="text-green-300 mb-2">‡∏ó‡∏µ‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</div>
                    <div class="text-4xl font-bold text-white" id="final-score-2">0</div>
                </div>
            </div>
            <button onclick="location.reload()" class="px-8 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-bold transition-colors">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

    </main>

    <!-- Chaos Modal -->
    <div id="chaos-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
        <div class="w-full max-w-2xl bg-slate-900 border-4 border-red-600 rounded-3xl p-8 text-center shadow-[0_0_50px_rgba(220,38,38,0.5)] chaos-bg relative overflow-hidden">
            <!-- Alert Icon -->
            <div class="text-8xl mb-4 animate-bounce">üö®</div>
            
            <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-2 neon-chaos uppercase" id="chaos-title">CHAOS EVENT!</h2>
            <p class="text-red-200 text-lg mb-8 tracking-wider">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏™‡∏∏‡∏î‡∏õ‡πà‡∏ß‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß! (‡∏ó‡∏∏‡∏Å‡πÜ 3 ‡∏Ç‡πâ‡∏≠)</p>
            
            <div class="bg-black/40 rounded-xl p-8 border border-white/10 mb-8 backdrop-blur-sm">
                <p id="chaos-desc" class="text-2xl md:text-3xl font-bold text-white leading-relaxed">
                    ...
                </p>
                <div id="chaos-effect-text" class="mt-4 text-yellow-400 font-mono text-lg hidden"></div>
            </div>

            <!-- Normal Close Button -->
            <button id="chaos-close-btn" onclick="closeChaos()" class="bg-white text-red-700 hover:bg-red-100 font-bold text-2xl py-4 px-12 rounded-full shadow-xl transition-transform hover:scale-105 active:scale-95 border-4 border-red-700">
                ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö! ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠
            </button>
            
            <!-- Challenge Winner Buttons (Hidden by default) -->
            <div id="challenge-buttons" class="hidden flex-col gap-4">
                <p class="text-yellow-400 font-bold mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ä‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏ô‡∏µ‡πâ (‡∏£‡∏±‡∏ö 3000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!)</p>
                <div class="grid grid-cols-3 gap-4">
                    <button onclick="resolveChallenge(0)" class="py-3 bg-red-600 hover:bg-red-500 rounded-lg text-white font-bold text-lg shadow-lg">‡πÅ‡∏î‡∏á‡∏ä‡∏ô‡∏∞!</button>
                    <button onclick="resolveChallenge(1)" class="py-3 bg-blue-600 hover:bg-blue-500 rounded-lg text-white font-bold text-lg shadow-lg">‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡∏ô‡∏∞!</button>
                    <button onclick="resolveChallenge(2)" class="py-3 bg-green-600 hover:bg-green-500 rounded-lg text-white font-bold text-lg shadow-lg">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ä‡∏ô‡∏∞!</button>
                </div>
                <button onclick="closeChaos()" class="mt-2 text-slate-400 hover:text-white underline text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≥‡πÑ‡∏î‡πâ (‡∏Ç‡πâ‡∏≤‡∏°)</button>
            </div>
        </div>
    </div>

    <!-- Start Overlay -->
    <div id="start-overlay" class="fixed inset-0 bg-slate-900 z-[60] flex flex-col items-center justify-center p-4">
        <h1 class="text-5xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-purple-500 mb-8 text-center neon-text">PHYSICS BATTLE</h1>
        <div class="bg-slate-800/80 p-6 rounded-xl border border-slate-600 max-w-2xl text-center mb-8 shadow-2xl">
            <h3 class="text-xl font-bold text-white mb-4">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (Sequential Mode)</h3>
            <ul class="text-slate-300 text-left space-y-3 list-disc pl-6 text-lg">
                <li>‡∏ï‡∏∞‡∏•‡∏∏‡∏¢‡πÇ‡∏à‡∏ó‡∏¢‡πå 30 ‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</li>
                <li>‡πÄ‡∏ß‡∏•‡∏≤ <span class="text-yellow-400 font-bold">4 ‡∏ô‡∏≤‡∏ó‡∏µ</span> ‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠</li>
                <li><span class="text-green-400 font-bold">‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å:</span> ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏ß‡∏•‡∏≤</li>
                <li><span class="text-red-400 font-bold">‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏ö 3 ‡∏ó‡∏µ‡∏°:</span> ‡πÇ‡∏î‡∏ô‡∏´‡∏±‡∏Å‡∏ó‡∏µ‡∏°‡∏•‡∏∞ -800 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                <li><span class="text-yellow-400 font-bold">‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©:</span> ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡∏°‡∏•‡∏∞ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                <li class="animate-pulse text-red-300 font-bold">‚ö†Ô∏è ‡∏°‡∏µ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏™‡∏∏‡∏î‡∏õ‡πà‡∏ß‡∏ô‡∏™‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ó‡∏∏‡∏Å‡πÜ 3 ‡∏Ç‡πâ‡∏≠! (50% ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢, 30% ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô, 20% ‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏ä‡∏¥‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•)</li>
            </ul>
        </div>
        <button onclick="startGame()" class="px-12 py-6 bg-gradient-to-r from-sky-600 to-blue-700 rounded-full text-3xl font-bold text-white hover:scale-105 transition-transform shadow-2xl shadow-sky-500/30 ring-4 ring-sky-500/20">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
        </button>
    </div>

    <script>
        // --- Game Config ---
        const TIME_LIMIT = 240; // 4 minutes
        
        // Data & Hints
        const categories = [
            "‡∏á‡∏≤‡∏ô (Work)", 
            "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå (Ek)", 
            "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á (Ep)", 
            "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (Eps)", 
            "‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏Ø (‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô)", 
            "‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏Ø (‡πÄ‡∏™‡∏µ‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô)"
        ];

        // Formula Hints mapping
        const categoryHints = [
            "W = Fs (‡πÅ‡∏£‡∏á x ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏£‡∏á) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ï‡πâ‡∏Å‡∏£‡∏≤‡∏ü F-s",
            "Ek = ¬Ωmv¬≤ (‡∏°‡∏ß‡∏•‡πÄ‡∏õ‡πá‡∏ô kg, ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏õ‡πá‡∏ô m/s)",
            "Ep = mgh (‡∏°‡∏ß‡∏• kg, g=10, ‡∏™‡∏π‡∏á m)",
            "Eps = ¬Ωkx¬≤ (k ‡∏Ñ‡πà‡∏≤‡∏ô‡∏¥‡∏à‡∏™‡∏õ‡∏£‡∏¥‡∏á, x ‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏î) ‡∏´‡∏£‡∏∑‡∏≠ ¬ΩFx",
            "Œ£E‚ÇÅ = Œ£E‚ÇÇ (‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏à‡∏∏‡∏î 1 = ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏à‡∏∏‡∏î 2)",
            "Œ£E‚ÇÅ + W = Œ£E‚ÇÇ (‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏ô + ‡∏á‡∏≤‡∏ô‡πÅ‡∏£‡∏á‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å = ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡πâ‡∏≤‡∏¢)"
        ];

        // Chaos Events Database - Categorized
        const chaosActivities = [
            { text: "üí™ Fitness! ‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏•‡∏∏‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ '‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ï‡∏ö {N} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á' ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ!" },
            { text: "üß± Core Strength! ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ó‡πà‡∏≤ '‡πÅ‡∏û‡∏•‡∏á‡∏Ñ‡πå (Plank) {N} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ' ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥!" },
            { text: "üî• Power Up! ‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡∏° '‡∏î‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô {N} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á' ‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ï‡πà‡∏≠!" }
        ];

        const chaosScoreEffects = [
            { effect: 'give_random', amount: 300, text: "Sky Bonus! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏à‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏£‡∏µ 300 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÉ‡∏´‡πâ 1 ‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ!" },
            { effect: 'give_all', amount: 100, text: "Happy Hour! ‡πÅ‡∏à‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏° ‡∏ó‡∏µ‡∏°‡∏•‡∏∞ 100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!" },
            { effect: 'give_lowest', amount: 500, text: "Underdog Boost! ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï 500 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!" },
            { effect: 'tax_leader', amount: 300, text: "Rich Tax! ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏≥‡πÇ‡∏î‡∏ô‡∏´‡∏±‡∏Å 300 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏†‡∏≤‡∏©‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏á!)" },
            { effect: 'swap_points', amount: 0, text: "Sharing! ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î 200 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" }
        ];

        const chaosChallenges = [
            { text: "üèÜ Plank Battle! ‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡πÅ‡∏û‡∏•‡∏á‡∏Ñ‡πå‡πÑ‡∏î‡πâ‡∏ô‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ 3,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!" },
            { text: "üèÜ Push-up King! ‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡∏ß‡∏¥‡∏î‡∏û‡∏∑‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ 3,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!" },
            { text: "üèÜ Speed Jack! ‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏ï‡∏ö ‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ 3,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!" }
        ];

        const questionsData = [
            // 1. ‡∏á‡∏≤‡∏ô (Work)
            [
                { q: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏ú‡∏•‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á 20 ‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô ‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏£‡∏≤‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ (‡∏à‡∏π‡∏•)", a: 100 },
                { q: "‡∏¢‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 10 kg ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏î‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á 3 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÇ‡∏î‡∏¢‡πÅ‡∏£‡∏á‡∏¢‡∏Å (g=10)", a: 300 },
                { q: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á 50 ‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏≥‡∏°‡∏∏‡∏° 60 ‡∏≠‡∏á‡∏®‡∏≤‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏£‡∏∞‡∏î‡∏±‡∏ö (cos60 = 0.5) ‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô", a: 250 },
                { q: "‡∏ä‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏ö‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏Å 50 N ‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏£‡∏≤‡∏ö‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥", a: 0 },
                { q: "‡πÅ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡∏Å‡∏£‡∏≤‡∏ü F-S ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° ‡∏ê‡∏≤‡∏ô 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏™‡∏π‡∏á 20 ‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô", a: 100 }
            ],
            // 2. ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå (Ek)
            [
                { q: "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏°‡∏ß‡∏• 1,000 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 10 m/s ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 50000 },
                { q: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 4 kg ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 5 m/s ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 50 },
                { q: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏°‡∏µ‡∏°‡∏ß‡∏• 2 kg ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå 100 ‡∏à‡∏π‡∏• ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (m/s)", a: 10 },
                { q: "‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 2 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°", a: 4 },
                { q: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 10 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 36 km/hr (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡πà‡∏≠‡∏ô) ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 500 }
            ],
            // 3. ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á (Ep)
            [
                { q: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏°‡∏ß‡∏• 2 kg ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ï‡πâ‡∏ô‡∏™‡∏π‡∏á 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 200 },
                { q: "‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏ü‡∏ï‡πå‡∏°‡∏ß‡∏• 500 kg ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô", a: 100000 },
                { q: "‡∏ä‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏°‡∏ß‡∏• 60 kg ‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 3000 },
                { q: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ A ‡∏°‡∏ß‡∏• 5 kg ‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏π‡∏á 4 ‡πÄ‡∏°‡∏ï‡∏£, ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ B ‡∏°‡∏ß‡∏• 2 kg ‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏π‡∏á 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏°‡∏µ Ep ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 0 },
                { q: "‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏ß‡∏• 1000 kg ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ñ‡∏±‡∏á‡∏™‡∏π‡∏á 10 ‡πÄ‡∏°‡∏ï‡∏£", a: 100000 }
            ],
            // 4. ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (Eps)
            [
                { q: "‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà k = 100 N/m ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å 0.1 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Å‡∏µ‡πà‡∏à‡∏π‡∏•", a: 0.5 }, 
                { q: "‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà k = 200 N/m ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å 0.1 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Å‡∏µ‡πà‡∏à‡∏π‡∏•", a: 1 }, 
                { q: "‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏Ñ‡πà‡∏≤ k = 200 N/m ‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å 1 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô", a: 100 },
                { q: "‡∏™‡∏õ‡∏£‡∏¥‡∏á k = 1000 N/m ‡∏´‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ 0.2 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô", a: 20 },
                { q: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏î‡∏∂‡∏á‡∏™‡∏õ‡∏£‡∏¥‡∏á 100 N ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å 2 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏™‡∏° (‡∏à‡∏π‡∏•)", a: 100 },
                { q: "‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å 2 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∞‡∏™‡∏° 200 ‡∏à‡∏π‡∏• ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏õ‡∏£‡∏¥‡∏á (N/m)", a: 100 },
                { q: "‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏™‡∏õ‡∏£‡∏¥‡∏á k=500 N/m ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏°‡∏î‡∏∏‡∏•‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å 0.4 ‡πÄ‡∏°‡∏ï‡∏£", a: 40 }
            ],
            // 5. ‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (Ideal)
            [
                { q: "‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 2 kg ‡∏à‡∏≤‡∏Å‡∏ï‡∏∂‡∏Å‡∏™‡∏π‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ç‡∏ì‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (‡∏à‡∏π‡∏•)", a: 400 },
                { q: "‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏ì‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô (m/s) (‡πÉ‡∏ä‡πâ g=10)", a: 10 },
                { q: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÑ‡∏ñ‡∏•‡∏•‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡πÄ‡∏Å‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ô‡∏¥‡∏ô (m/s)", a: 10 },
                { q: "‡∏¢‡∏¥‡∏á‡∏•‡∏π‡∏Å‡∏õ‡∏∑‡∏ô‡∏°‡∏ß‡∏• 0.02 kg ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ü‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 100 m/s ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£", a: 500 },
                { q: "‡∏£‡∏ñ‡πÑ‡∏ü‡πÄ‡∏´‡∏≤‡∏∞‡∏°‡∏ß‡∏• 500 kg ‡πÑ‡∏´‡∏•‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏•‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏∞‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (‡∏à‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏á)", a: 75000 }
            ],
            // 6. ‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (Non-Ideal)
            [
                { q: "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏°‡∏ß‡∏• 5 kg ‡πÑ‡∏ñ‡∏•‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏™‡∏π‡∏á 4 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ñ‡∏∂‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå 150 ‡∏à‡∏π‡∏• ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏£‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏ô (‡∏Ç‡∏ô‡∏≤‡∏î)", a: 50 },
                { q: "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏°‡∏ß‡∏• 1000 kg ‡πÄ‡∏ö‡∏£‡∏Å‡∏à‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 20 m/s ‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 50 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏ï‡πâ‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô)", a: 4000 },
                { q: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á 100 N ‡∏î‡∏±‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ 5 kg ‡πÑ‡∏õ‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏£‡∏≤‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏∑‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏õ‡∏•‡∏≤‡∏¢ 10 m/s (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πà‡∏á) ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", a: 750 },
                { q: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ 2 kg ‡∏ï‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 10 m/s (‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥) ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®", a: 300 },
                { q: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏¢‡∏Å‡∏Ç‡∏≠‡∏á 200 N ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÅ‡∏ï‡πà‡πÑ‡∏î‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1500 ‡∏à‡∏π‡∏• ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏Å‡∏µ‡πà‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå", a: 25 }
            ]
        ];

        // --- State ---
        let flatQuestions = [];
        let currentIndex = 0;
        let scores = [0, 0, 0];
        let timerInterval = null;
        let timeLeft = TIME_LIMIT;
        let teamsAttemptedCurrent = [false, false, false];
        let hintUsed = [false, false, false]; // New: Track hint usage per team
        let audioCtx = null;
        let currentQData = null;

        // --- Initialization ---
        function initData() {
            flatQuestions = [];
            questionsData.forEach((catQs, catIdx) => {
                catQs.forEach((q, lvl) => {
                    flatQuestions.push({
                        ...q,
                        category: categories[catIdx],
                        hintText: categoryHints[catIdx], // Attach hint
                        level: lvl + 1,
                        baseScore: (lvl + 1) * 1000
                    });
                });
            });
        }

        function startGame() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            
            initData();
            document.getElementById('start-overlay').style.display = 'none';
            document.getElementById('game-container').classList.remove('hidden');
            
            currentIndex = 0;
            hintUsed = [false, false, false]; // Reset Hints
            updateHintBadges();
            loadQuestion();
        }

        // --- Hint Logic ---
        function useHint(teamId) {
            if (hintUsed[teamId]) return;

            // Confirm
            if(!confirm(`‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(teamId)} ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏π‡∏ï‡∏£? (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)`)) return;

            hintUsed[teamId] = true;
            updateHintBadges();
            
            // Show hint
            const hintBox = document.getElementById('hint-display');
            document.getElementById('hint-content').innerText = currentQData.hintText;
            document.getElementById('hint-user').innerText = `‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢ ‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(teamId)}`;
            hintBox.classList.remove('hidden');
            
            // Disable button for this team immediately
            document.getElementById(`btn-hint-${teamId}`).disabled = true;
            document.getElementById(`btn-hint-${teamId}`).innerText = "‚ùå ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß";

            playSound('correct'); // reuse sound for feedback
        }

        function updateHintBadges() {
            [0, 1, 2].forEach(i => {
                const badge = document.getElementById(`hint-badge-${i}`);
                if (hintUsed[i]) {
                    badge.classList.remove('text-yellow-400');
                    badge.classList.add('text-slate-600');
                    badge.innerText = "‚ùå ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß";
                } else {
                    badge.classList.remove('text-slate-600');
                    badge.classList.add('text-yellow-400');
                    badge.innerText = "üí° ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢";
                }
            });
        }

        // --- Core Logic ---
        function loadQuestion() {
            if (currentIndex >= flatQuestions.length) {
                endGame();
                return;
            }

            currentQData = flatQuestions[currentIndex];
            teamsAttemptedCurrent = [false, false, false];
            timeLeft = TIME_LIMIT;
            
            // UI Reset
            document.getElementById('current-q-num').innerText = currentIndex + 1;
            document.getElementById('q-category').innerText = currentQData.category;
            document.getElementById('q-difficulty').innerText = currentQData.level;
            document.getElementById('q-text').innerText = currentQData.q;
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            
            // Hint UI Reset for new question
            document.getElementById('hint-display').classList.add('hidden');
            
            // Feedback Reset
            const fb = document.getElementById('feedback-msg');
            fb.classList.add('hidden');
            fb.className = 'hidden mt-6 text-center p-4 rounded-xl text-xl font-bold border-2';
            
            // Buttons Reset
            [0, 1, 2].forEach(i => {
                // Team Answer Button
                const btn = document.getElementById(`btn-team-${i}`);
                btn.disabled = false;
                btn.classList.remove('opacity-30', 'grayscale');
                
                // Hint Button check
                const hintBtn = document.getElementById(`btn-hint-${i}`);
                if (hintUsed[i]) {
                    hintBtn.disabled = true;
                    hintBtn.innerText = "‚ùå ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß";
                } else {
                    hintBtn.disabled = false;
                    hintBtn.innerText = "üí° ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢";
                }
            });

            document.getElementById('next-area').classList.add('hidden');
            
            const card = document.getElementById('question-card');
            card.classList.remove('slide-in');
            void card.offsetWidth; 
            card.classList.add('slide-in');

            startTimer();
        }

        function startTimer() {
            updateTimerDisplay();
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 10 && timeLeft > 0) {
                    playSound('tick');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timer-text').innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            
            const pct = (timeLeft / TIME_LIMIT) * 100;
            const bar = document.getElementById('timer-bar');
            bar.style.width = `${pct}%`;
            
            if (pct < 20) bar.className = 'h-full w-full transition-all duration-1000 ease-linear bg-red-600';
            else if (pct < 50) bar.className = 'h-full w-full transition-all duration-1000 ease-linear bg-yellow-500';
            else bar.className = 'h-full bg-gradient-to-r from-green-500 to-red-500 w-full transition-all duration-1000 ease-linear';
        }

        function submitAnswer(teamId) {
            const input = document.getElementById('answer-input').value;
            if (input === '') return;
            
            const ans = parseFloat(input); 
            const correctAns = currentQData.a;
            
            const isCorrect = Math.abs(ans - correctAns) < 0.001; 

            const btn = document.getElementById(`btn-team-${teamId}`);
            const feedback = document.getElementById('feedback-msg');
            feedback.classList.remove('hidden');

            if (isCorrect) {
                handleCorrect(teamId);
            } else {
                playSound('wrong');
                teamsAttemptedCurrent[teamId] = true;
                btn.disabled = true;
                
                let msg = ans > correctAns ? "‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ!" : "‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ!";
                feedback.innerText = `‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(teamId)} ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î: ${msg}`;
                feedback.className = 'mt-6 text-center p-4 rounded-xl text-xl font-bold border-2 border-red-500 bg-red-900/30 text-red-300 block shake';

                if (teamsAttemptedCurrent.every(t => t)) {
                    handleAllFail();
                }
            }
        }

        function handleCorrect(teamId) {
            playSound('correct');
            clearInterval(timerInterval);
            
            document.getElementById('answer-input').disabled = true;
            [0,1,2].forEach(i => {
                document.getElementById(`btn-team-${i}`).disabled = true;
                document.getElementById(`btn-hint-${i}`).disabled = true; // Disable hint interaction too
            });

            const hasWrongAttempts = teamsAttemptedCurrent.some(t => t === true);
            
            const standardBase = 1000;
            const retryBase = 600;
            const finalBase = hasWrongAttempts ? retryBase : standardBase;
            
            const timeRatio = timeLeft / TIME_LIMIT;
            const bonus = Math.floor(finalBase * timeRatio * 0.5);
            const totalScore = finalBase + bonus;
            
            scores[teamId] += totalScore;
            updateScores();

            const feedback = document.getElementById('feedback-msg');
            feedback.innerHTML = `‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(teamId)} ‡∏£‡∏±‡∏ö‡πÑ‡∏õ <span class="text-3xl">${totalScore}</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br><span class="text-sm opacity-75">(Base: ${finalBase}, Bonus: ${bonus})</span>`;
            feedback.className = 'mt-6 text-center p-4 rounded-xl text-xl font-bold border-2 border-green-500 bg-green-900/30 text-green-300 block';

            showNextButton();
        }

        function handleAllFail() {
            playSound('wrong');
            clearInterval(timerInterval);
            document.getElementById('answer-input').disabled = true;
            [0,1,2].forEach(i => document.getElementById(`btn-hint-${i}`).disabled = true);

            scores = scores.map(s => s - 800);
            updateScores();

            const feedback = document.getElementById('feedback-msg');
            feedback.innerHTML = `‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏ö 3 ‡∏ó‡∏µ‡∏°! ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡πÇ‡∏î‡∏ô‡∏´‡∏±‡∏Å <span class="text-red-400">800</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br>‡πÄ‡∏â‡∏•‡∏¢: <span class="text-white">${currentQData.a}</span>`;
            feedback.className = 'mt-6 text-center p-4 rounded-xl text-xl font-bold border-2 border-red-600 bg-red-900/50 text-white block';
            
            showNextButton();
        }

        function handleTimeout() {
            playSound('wrong');
            document.getElementById('answer-input').disabled = true;
            [0,1,2].forEach(i => {
                document.getElementById(`btn-team-${i}`).disabled = true;
                document.getElementById(`btn-hint-${i}`).disabled = true;
            });

            scores = scores.map(s => s - 500);
            updateScores();

            const feedback = document.getElementById('feedback-msg');
            feedback.classList.remove('hidden');
            feedback.innerHTML = `‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡πÇ‡∏î‡∏ô‡∏´‡∏±‡∏Å <span class="text-orange-400">500</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br>‡πÄ‡∏â‡∏•‡∏¢: <span class="text-white">${currentQData.a}</span>`;
            feedback.className = 'mt-6 text-center p-4 rounded-xl text-xl font-bold border-2 border-orange-500 bg-orange-900/50 text-white block';

            showNextButton();
        }

        function showNextButton() {
            document.getElementById('next-area').classList.remove('hidden');
        }

        function nextQuestion() {
            currentIndex++;
            
            // Chaos Trigger every 3 questions (when index becomes 3, 6, 9...)
            if (currentIndex > 0 && currentIndex % 3 === 0 && currentIndex < flatQuestions.length) {
                triggerChaos();
            } else {
                loadQuestion();
            }
        }
        
        // --- Chaos Logic ---
        function triggerChaos() {
            const modal = document.getElementById('chaos-modal');
            const title = document.getElementById('chaos-title');
            const desc = document.getElementById('chaos-desc');
            const effectText = document.getElementById('chaos-effect-text');
            const closeBtn = document.getElementById('chaos-close-btn');
            const challengeBtns = document.getElementById('challenge-buttons');
            
            // Reset UI
            effectText.classList.add('hidden');
            closeBtn.classList.remove('hidden');
            challengeBtns.classList.add('hidden');
            title.innerText = "CHAOS EVENT!";
            
            // Random Probability (50% Activity, 30% Score, 20% Challenge)
            const rand = Math.random();
            let eventType = 'activity';
            
            if (rand < 0.5) {
                eventType = 'activity';
            } else if (rand < 0.8) {
                eventType = 'score';
            } else {
                eventType = 'challenge';
            }
            
            if (eventType === 'activity') {
                const event = chaosActivities[Math.floor(Math.random() * chaosActivities.length)];
                // Randomize N (5-10)
                const n = Math.floor(Math.random() * 6) + 5;
                desc.innerText = event.text.replace('{N}', n);
                
            } else if (eventType === 'score') {
                const event = chaosScoreEffects[Math.floor(Math.random() * chaosScoreEffects.length)];
                desc.innerText = event.text;
                applyChaosScoreEffect(event, effectText);
                
            } else if (eventType === 'challenge') {
                const event = chaosChallenges[Math.floor(Math.random() * chaosChallenges.length)];
                desc.innerText = event.text;
                title.innerText = "‚öîÔ∏è CHALLENGE!";
                
                // Show challenge buttons
                closeBtn.classList.add('hidden');
                challengeBtns.classList.remove('hidden');
                challengeBtns.classList.add('flex');
            }
            
            modal.classList.remove('hidden');
            playSound('chaos');
        }
        
        function applyChaosScoreEffect(event, displayEl) {
            let msg = "";
            
            if (event.effect === 'give_random') {
                const luckyTeam = Math.floor(Math.random() * 3);
                scores[luckyTeam] += event.amount;
                msg = `üéâ ‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(luckyTeam)} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${event.amount} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
            } else if (event.effect === 'give_all') {
                scores = scores.map(s => s + event.amount);
                msg = `üéâ ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${event.amount} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
            } else if (event.effect === 'give_lowest') {
                const minScore = Math.min(...scores);
                // Find all teams with min score
                const lowestTeams = scores.map((s, i) => s === minScore ? i : -1).filter(i => i !== -1);
                lowestTeams.forEach(i => scores[i] += event.amount);
                msg = `üõ°Ô∏è ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${event.amount} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
            } else if (event.effect === 'tax_leader') {
                const maxScore = Math.max(...scores);
                if (maxScore > 0) { // Only tax if positive
                    const leaders = scores.map((s, i) => s === maxScore ? i : -1).filter(i => i !== -1);
                    leaders.forEach(i => scores[i] -= event.amount);
                    msg = `üí∏ ‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÇ‡∏î‡∏ô‡∏´‡∏±‡∏Å ${event.amount} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
                } else {
                    msg = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏Å ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ!";
                }
            } else if (event.effect === 'swap_points') {
                 const maxScore = Math.max(...scores);
                 const minScore = Math.min(...scores);
                 
                 const leader = scores.findIndex(s => s === maxScore);
                 let loser = scores.findIndex(s => s === minScore);
                 
                 if (leader !== loser) {
                     scores[leader] -= 200;
                     scores[loser] += 200;
                     msg = `ü§ù ‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(leader)} ‡πÅ‡∏ö‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(loser)} 200 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
                 } else {
                      msg = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î ‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏•‡∏±‡∏á! (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•)";
                 }
            }
            
            updateScores();
            displayEl.innerText = msg;
            displayEl.classList.remove('hidden');
        }
        
        function resolveChallenge(winnerId) {
            scores[winnerId] += 3000;
            updateScores();
            
            const desc = document.getElementById('chaos-desc');
            const challengeBtns = document.getElementById('challenge-buttons');
            const effectText = document.getElementById('chaos-effect-text');
            const closeBtn = document.getElementById('chaos-close-btn');
            
            challengeBtns.classList.add('hidden');
            challengeBtns.classList.remove('flex');
            
            desc.innerText = "‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß!";
            effectText.innerText = `üëë ‡∏ó‡∏µ‡∏°‡∏™‡∏µ${getTeamName(winnerId)} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 3,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`;
            effectText.classList.remove('hidden');
            effectText.classList.add('text-3xl');
            
            closeBtn.classList.remove('hidden');
            playSound('correct');
        }
        
        function closeChaos() {
            document.getElementById('chaos-modal').classList.add('hidden');
            loadQuestion();
        }

        function endGame() {
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            
            document.getElementById('final-score-0').innerText = scores[0];
            document.getElementById('final-score-1').innerText = scores[1];
            document.getElementById('final-score-2').innerText = scores[2];
            playSound('correct'); 
        }

        function updateScores() {
            document.getElementById('score-0').innerText = scores[0];
            document.getElementById('score-1').innerText = scores[1];
            document.getElementById('score-2').innerText = scores[2];
        }

        function getTeamName(id) {
            return ["‡πÅ‡∏î‡∏á", "‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß"][id];
        }

        function playSound(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.exponentialRampToValueAtTime(880, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
                osc.start(now);
                osc.stop(now + 0.6);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.4);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'tick') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'chaos') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.linearRampToValueAtTime(800, now + 0.3);
                osc.frequency.linearRampToValueAtTime(400, now + 0.6);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 1.0);
                osc.start(now);
                osc.stop(now + 1.0);
            }
        }
    </script>
</body>
</html>
