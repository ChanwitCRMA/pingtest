<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Master Challenge</title>
    <!-- ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Kanit ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏∏‡∏Å -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00f2ea;
            --secondary-color: #ff0050;
            --bg-dark: #0f0c29;
            --glass-bg: rgba(16, 18, 27, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-color: #ffffff;
            --card-glow: 0 0 20px rgba(0, 242, 234, 0.1);
        }

        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            color: var(--text-color);
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Animated Background Particles */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            animation: floatOrb 10s infinite alternate;
        }
        .orb-1 { width: 300px; height: 300px; background: var(--secondary-color); top: -50px; left: -50px; opacity: 0.4; }
        .orb-2 { width: 400px; height: 400px; background: var(--primary-color); bottom: -100px; right: -100px; opacity: 0.3; animation-delay: -5s; }

        @keyframes floatOrb {
            0% { transform: translate(0, 0); }
            100% { transform: translate(30px, 50px); }
        }

        /* Main Container */
        .container {
            width: 95%;
            max-width: 900px;
            height: 90vh;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            z-index: 10;
        }

        /* Screens Transition */
        .screen {
            flex: 1;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            animation: slideUp 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        .screen.active { display: flex; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Typography */
        h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 5px;
            text-transform: uppercase;
            background: linear-gradient(to right, #00f2ea, #ff0050);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 242, 234, 0.5);
            letter-spacing: 2px;
        }

        .subtitle { font-size: 1.2rem; color: #a0a0a0; margin-bottom: 40px; font-weight: 300; }

        /* Inputs */
        input[type="text"], input[type="number"] {
            width: 100%;
            max-width: 350px;
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid rgba(255,255,255,0.1);
            font-size: 1.2rem;
            text-align: center;
            outline: none;
            transition: 0.3s;
            font-family: 'Kanit', sans-serif;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            margin-bottom: 20px;
        }

        input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(0, 242, 234, 0.4);
            transform: scale(1.02);
        }

        /* Buttons */
        .btn {
            padding: 12px 35px;
            border-radius: 50px;
            border: none;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover { transform: translateY(-3px); filter: brightness(1.2); }
        .btn:active { transform: translateY(1px); }

        .btn-primary {
            background: linear-gradient(45deg, #00f2ea, #00c6ff);
            color: #000;
            box-shadow: 0 5px 20px rgba(0, 242, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff0050, #ff0080);
            color: #fff;
            box-shadow: 0 5px 20px rgba(255, 0, 80, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Top Bar */
        .top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            box-sizing: border-box;
            z-index: 20;
        }

        .timer-box {
            font-size: 1.4rem;
            font-weight: 800;
            color: #fff;
            background: rgba(255, 0, 80, 0.2);
            padding: 8px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 0, 80, 0.5);
            box-shadow: 0 0 15px rgba(255, 0, 80, 0.3);
            display: flex; align-items: center; gap: 8px;
        }

        .finish-icon-btn {
            background: #ffb700;
            color: #000;
            border: none;
            width: 40px; height: 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 10px;
            transition: 0.3s;
        }
        .finish-icon-btn:hover { transform: scale(1.1) rotate(10deg); }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%; height: 4px; background: rgba(255,255,255,0.1);
            position: absolute; top: 0; left: 0;
        }
        .progress-bar-fill {
            height: 100%; background: var(--primary-color);
            width: 0%; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 0 10px var(--primary-color);
        }

        /* Question Card */
        .question-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%; max-width: 700px;
            margin-top: 20px;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
        }

        .question-badge {
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 800;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .badge-easy { background: rgba(0, 242, 234, 0.2); color: #00f2ea; border: 1px solid #00f2ea; }
        .badge-medium { background: rgba(255, 183, 0, 0.2); color: #ffb700; border: 1px solid #ffb700; }
        .badge-hard { background: rgba(255, 0, 80, 0.2); color: #ff0050; border: 1px solid #ff0050; }

        .question-text {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #fff;
        }

        .input-area {
            display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap; width: 100%;
        }
        .unit-label { font-weight: 600; color: #aaa; font-size: 1.2rem; }

        .nav-buttons {
            display: flex; justify-content: center; width: 100%; margin-top: 25px; gap: 15px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background: #1a1a2e;
            padding: 40px; border-radius: 24px;
            text-align: center; width: 90%; max-width: 450px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 50px rgba(0, 242, 234, 0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: #fff;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Analysis & Score */
        .score-circle {
            width: 160px; height: 160px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,242,234,0.1) 0%, rgba(0,0,0,0) 70%);
            border: 4px double #00f2ea;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-size: 4rem; font-weight: 800; color: #fff;
            margin: 20px auto;
            text-shadow: 0 0 20px #00f2ea;
            box-shadow: 0 0 30px rgba(0, 242, 234, 0.2);
            animation: pulseScore 2s infinite;
        }
        
        @keyframes pulseScore {
            0% { box-shadow: 0 0 30px rgba(0, 242, 234, 0.2); }
            50% { box-shadow: 0 0 60px rgba(0, 242, 234, 0.5); }
            100% { box-shadow: 0 0 30px rgba(0, 242, 234, 0.2); }
        }

        .analysis-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; width: 100%; margin-top: 20px;
        }
        .analysis-card {
            background: rgba(255,255,255,0.03);
            padding: 20px; border-radius: 16px; text-align: left;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
            display: flex; flex-direction: column;
            justify-content: space-between;
        }
        .analysis-card:hover { background: rgba(255,255,255,0.08); transform: translateY(-5px); }

        .stat-bar-bg { height: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .stat-bar-fill { height: 100%; border-radius: 5px; box-shadow: 0 0 10px currentColor; }
        
        .advice-text {
            font-size: 0.85rem; color: #ddd; margin-top: 10px; 
            background: rgba(0,0,0,0.2); padding: 8px; border-radius: 8px;
            border-left: 3px solid #ccc;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99;
        }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .question-text { font-size: 1.2rem; }
            .top-bar { padding: 15px; }
            .timer-box { font-size: 1.1rem; padding: 5px 15px; }
            .btn { width: 100%; margin: 5px 0; }
            .nav-buttons { flex-direction: column-reverse; }
        }
    </style>
</head>
<body>

<div class="orb orb-1"></div>
<div class="orb orb-2"></div>

<!-- Confetti Canvas -->
<canvas id="confetti-canvas"></canvas>

<!-- Custom Modal -->
<div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="margin-top:0; color:#00f2ea;">‚ö° ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö?</h2>
        <p style="color:#ccc;">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö?</p>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:30px;">
            <button class="btn btn-secondary" onclick="closeModal()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô</button>
            <button class="btn btn-danger" onclick="confirmFinish()">üöÄ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏•‡∏¢!</button>
        </div>
    </div>
</div>

<div id="timeUpModal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="color:#ff0050; margin-top:0; font-size:2.5rem;">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h2>
        <p>‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...</p>
        <button class="btn btn-primary" onclick="confirmFinish()">‡∏î‡∏π‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>
</div>

<div class="container">
    <div class="progress-bar-container">
        <div id="globalProgress" class="progress-bar-fill"></div>
    </div>

    <!-- 1. Start Screen -->
    <div id="start-screen" class="screen active">
        <div style="font-size:5rem; margin-bottom:-20px;">‚öõÔ∏è</div>
        <h1>Physics Quest</h1>
        <div class="subtitle">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏Å‡∏é‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô | 15 ‡∏î‡πà‡∏≤‡∏ô | 30 ‡∏ô‡∏≤‡∏ó‡∏µ</div>
        
        <div style="width: 100%; max-width: 400px; position:relative;">
            <label style="display:block; text-align:left; margin-bottom: 8px; font-weight:600; color:#00f2ea; letter-spacing:1px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡πâ‡∏≤‡∏ä‡∏¥‡∏á (Player Name)</label>
            <input type="text" id="studentName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡πà‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." autocomplete="off">
            <button class="btn btn-primary" style="width: 100%; margin-top:10px;" onclick="startQuiz()">üéÆ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
        </div>
    </div>

    <!-- 2. Quiz Screen -->
    <div id="quiz-screen" class="screen" style="justify-content: flex-start; padding-top: 80px;">
        <div class="top-bar" style="position: absolute; top:0; left:0;">
            <div style="font-weight:600; font-size:1rem; color:#fff;">
                üë§ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: <span id="displayStudentName" style="color:#00f2ea;">Guest</span>
            </div>
            <div style="display:flex; align-items:center;">
                <div class="timer-box">
                    ‚è≥ <span id="timer">30:00</span>
                </div>
                <button class="finish-icon-btn" title="‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" onclick="requestSubmit()">üèÅ</button>
            </div>
        </div>

        <div class="question-card">
            <div id="questionBadge" class="question-badge badge-easy">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢</div>
            <div style="color:#aaa; font-size:0.9rem; margin-bottom:5px; font-weight:300;">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà <span id="currentQNum" style="color:#fff; font-weight:bold;">1</span> / 15</div>
            <div id="questionText" class="question-text">Loading Data...</div>
            
            <div class="input-area">
                <input type="number" id="answerInput" step="any" placeholder="‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö" onkeydown="checkEnter(event)">
                <span id="unitLabel" class="unit-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
            </div>
        </div>

        <div class="nav-buttons">
            <button id="btnPrev" class="btn btn-secondary" onclick="prevQuestion()" style="flex:1;">‚ùÆ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button id="btnNext" class="btn btn-primary" onclick="nextQuestion()" style="flex:1;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ùØ</button>
            <button id="btnSubmit" class="btn btn-danger" onclick="requestSubmit()" style="flex:1; display: none;">üèÜ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
        </div>
    </div>

    <!-- 3. Result Screen -->
    <div id="result-screen" class="screen">
        <div style="width:100%; max-width:750px; padding-bottom:40px;">
            <h2 style="color:#fff; text-transform:uppercase; margin-bottom:5px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h2>
            <div id="resultStudentName" style="color:#aaa; margin-bottom:20px;"></div>
            
            <div class="score-circle">
                <div style="font-size:1rem; color:#00f2ea; margin-bottom:-10px;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
                <div><span id="finalScore">0</span><span style="font-size:1.5rem; color:#aaa;">/15</span></div>
            </div>
            
            <div id="passFailMsg" style="font-size: 1.5rem; font-weight: 800; margin-bottom: 30px;"></div>

            <h3 style="text-align:left; color:#00f2ea; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á-‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô</h3>
            <div class="analysis-grid" id="analysisGrid"></div>

            <button class="btn btn-secondary" onclick="location.reload()" style="margin-top: 40px; width:100%;">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>

</div>

<script>
    // --- Data ---
    const poolQuestions = [
        // Easy
        { level: "Easy", text: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 50 ‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô ‡∏ú‡∏•‡∏±‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏£‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ", answer: 500, unit: "J" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 2 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 10 m/s ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå", answer: 100, unit: "J" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 10 kg ‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á", answer: 500, unit: "J" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ï‡∏Å‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏∂‡∏Å‡∏™‡∏π‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", answer: 20, unit: "m/s" },
        { level: "Easy", text: "‡πÅ‡∏Å‡∏ß‡πà‡∏á‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 0.8 ‡πÄ‡∏°‡∏ï‡∏£ (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î) ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", answer: 4, unit: "m/s" },
        { level: "Easy", text: "‡πÇ‡∏¢‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡πâ‡∏ô 30 m/s ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£", answer: 45, unit: "m" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÑ‡∏ñ‡∏•‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏•‡∏∑‡πà‡∏ô‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", answer: 10, unit: "m/s" },
        // Medium
        { level: "Medium", text: "‡∏£‡∏ñ‡πÑ‡∏ü‡πÄ‡∏´‡∏≤‡∏∞‡∏°‡∏ß‡∏• 500 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î A ‡∏™‡∏π‡∏á 25 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏•‡∏á‡∏°‡∏≤‡∏¢‡∏±‡∏á‡∏à‡∏∏‡∏î B ‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î B ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà A)", answer: 20, unit: "m/s" },
        { level: "Medium", text: "‡∏™‡∏õ‡∏£‡∏¥‡∏á (k=800 N/m) ‡∏ñ‡∏π‡∏Å‡∏Å‡∏î‡∏´‡∏î 0.1 m ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏à‡∏∞‡∏î‡∏µ‡∏î‡∏°‡∏ß‡∏• 2 kg ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", answer: 2, unit: "m/s" },
        { level: "Medium", text: "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏°‡∏ß‡∏• 1,000 kg ‡∏ß‡∏¥‡πà‡∏á 20 m/s ‡πÄ‡∏ö‡∏£‡∏Å‡∏à‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏ô 100 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏ï‡πâ‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢", answer: 2000, unit: "N" },
        { level: "Medium", text: "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏°‡∏ß‡∏• 5 kg ‡πÑ‡∏ñ‡∏•‡∏•‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏π‡∏á 4 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏¢‡∏≤‡∏ß 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏≠‡∏î‡∏µ ‡∏à‡∏á‡∏´‡∏≤‡πÅ‡∏£‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏ô", answer: 20, unit: "N" },
        { level: "Medium", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 4 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5 m/s ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏ô‡∏™‡∏õ‡∏£‡∏¥‡∏á (k=400 N/m) ‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏´‡∏î‡∏ï‡∏±‡∏ß‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£", answer: 0.5, unit: "m" },
        // Hard
        { level: "Hard", text: "‡∏Å‡∏î‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏´‡∏î‡∏•‡∏á 0.2 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏µ‡∏î‡∏°‡∏ß‡∏• 0.5 kg ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏î‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ k ‡∏Ç‡∏≠‡∏á‡∏™‡∏õ‡∏£‡∏¥‡∏á", answer: 1000, unit: "N/m" },
        { level: "Hard", text: "‡∏ö‡∏•‡πá‡∏≠‡∏Å 2 kg ‡∏≠‡∏±‡∏î‡∏™‡∏õ‡∏£‡∏¥‡∏á (k=1000) ‡∏´‡∏î 0.2 m ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏û‡∏∏‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£ (‡πÅ‡∏ô‡∏ß‡∏î‡∏¥‡πà‡∏á)", answer: 1, unit: "m" },
        { level: "Hard", text: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏∂‡∏Å‡∏™‡∏π‡∏á 25 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡πâ‡∏ô 20 m/s ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", answer: 30, unit: "m/s" }
    ];

    // --- State ---
    let quizQuestions = [];
    let userAnswers = [];
    let currentQIndex = 0;
    let timerInterval;
    let timeRemaining = 30 * 60; 

    // --- Core Logic ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz() {
        const name = document.getElementById('studentName').value.trim();
        if(!name) {
            const input = document.getElementById('studentName');
            input.style.borderColor = "#ff0050";
            input.style.boxShadow = "0 0 20px #ff0050";
            setTimeout(() => {
                input.style.borderColor = "rgba(255,255,255,0.1)";
                input.style.boxShadow = "none";
            }, 1000);
            input.focus();
            return;
        }

        document.getElementById('displayStudentName').innerText = name;
        
        const easyQ = shuffleArray(poolQuestions.filter(q => q.level === 'Easy'));
        const mediumQ = shuffleArray(poolQuestions.filter(q => q.level === 'Medium'));
        const hardQ = shuffleArray(poolQuestions.filter(q => q.level === 'Hard'));
        
        quizQuestions = [...easyQ, ...mediumQ, ...hardQ];
        userAnswers = new Array(quizQuestions.length).fill(null);

        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');

        currentQIndex = 0;
        renderQuestion();
        startTimer();
    }

    function startTimer() {
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay();
            if(timeRemaining <= 0) {
                clearInterval(timerInterval);
                document.getElementById('timeUpModal').style.display = 'flex';
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        const timerEl = document.getElementById('timer');
        timerEl.innerText = display;
        
        if(timeRemaining < 60) {
            timerEl.style.color = '#ff0050';
            timerEl.style.textShadow = '0 0 10px #ff0050';
        }
    }

    function renderQuestion() {
        const q = quizQuestions[currentQIndex];
        
        const badge = document.getElementById('questionBadge');
        badge.className = 'question-badge';
        if(q.level === 'Easy') { badge.classList.add('badge-easy'); badge.innerText = "‚≠ê ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢"; }
        else if(q.level === 'Medium') { badge.classList.add('badge-medium'); badge.innerText = "‚≠ê‚≠ê ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á"; }
        else { badge.classList.add('badge-hard'); badge.innerText = "‚≠ê‚≠ê‚≠ê ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏¢‡∏≤‡∏Å"; }

        document.getElementById('currentQNum').innerText = currentQIndex + 1;
        document.getElementById('questionText').innerText = q.text;
        document.getElementById('unitLabel').innerText = q.unit;

        const input = document.getElementById('answerInput');
        input.value = userAnswers[currentQIndex] !== null ? userAnswers[currentQIndex] : '';
        input.focus();

        document.getElementById('btnPrev').style.visibility = currentQIndex === 0 ? 'hidden' : 'visible';
        
        if (currentQIndex === quizQuestions.length - 1) {
            document.getElementById('btnNext').style.display = 'none';
            document.getElementById('btnSubmit').style.display = 'block';
        } else {
            document.getElementById('btnNext').style.display = 'block';
            document.getElementById('btnSubmit').style.display = 'none';
        }

        const progress = ((currentQIndex + 1) / quizQuestions.length) * 100;
        document.getElementById('globalProgress').style.width = `${progress}%`;
    }

    function saveCurrentAnswer() {
        const input = document.getElementById('answerInput');
        if(input.value !== '') {
            userAnswers[currentQIndex] = parseFloat(input.value);
        } else {
            userAnswers[currentQIndex] = null;
        }
    }

    function nextQuestion() {
        saveCurrentAnswer();
        if(currentQIndex < quizQuestions.length - 1) {
            currentQIndex++;
            renderQuestion();
        }
    }

    function prevQuestion() {
        saveCurrentAnswer();
        if(currentQIndex > 0) {
            currentQIndex--;
            renderQuestion();
        }
    }

    function checkEnter(e) {
        if(e.key === 'Enter') {
            if(currentQIndex < quizQuestions.length - 1) {
                nextQuestion();
            } else {
                requestSubmit();
            }
        }
    }

    function requestSubmit() {
        saveCurrentAnswer();
        document.getElementById('confirmModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('confirmModal').style.display = 'none';
    }

    function confirmFinish() {
        clearInterval(timerInterval);
        document.getElementById('confirmModal').style.display = 'none';
        document.getElementById('timeUpModal').style.display = 'none';
        
        calculateResults();
        
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        
        // Trigger Confetti
        fireConfetti();
    }

    function calculateResults() {
        let score = 0;
        // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Label ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (advice)
        let stats = {
            Easy: { total: 0, correct: 0, label: "‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢", color: "#00f2ea" },
            Medium: { total: 0, correct: 0, label: "‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏•‡∏≤‡∏á", color: "#ffb700" },
            Hard: { total: 0, correct: 0, label: "‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏Å", color: "#ff0050" }
        };

        quizQuestions.forEach((q, i) => {
            const userAns = userAnswers[i];
            const isCorrect = userAns !== null && Math.abs(userAns - q.answer) < 0.01;
            
            stats[q.level].total++;
            if(isCorrect) {
                score++;
                stats[q.level].correct++;
            }
        });

        document.getElementById('resultStudentName').innerText = "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " + document.getElementById('studentName').value;
        const scoreEl = document.getElementById('finalScore');
        scoreEl.innerText = score;
        
        if(score >= 12) scoreEl.style.color = "#00f2ea";
        else if(score >= 8) scoreEl.style.color = "#ffb700";
        else scoreEl.style.color = "#ff0050";

        // Rank Feedback
        const msgDiv = document.getElementById('passFailMsg');
        const percentage = (score / quizQuestions.length) * 100;
        if(percentage >= 80) {
            msgDiv.innerHTML = "<span style='color:#00f2ea; text-shadow:0 0 20px #00f2ea;'>üëë ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡πÄ‡∏ó‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå</span>";
        } else if (percentage >= 50) {
            msgDiv.innerHTML = "<span style='color:#ffb700; text-shadow:0 0 20px #ffb700;'>‚ö° ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå</span>";
        } else {
            msgDiv.innerHTML = "<span style='color:#ff0050; text-shadow:0 0 20px #ff0050;'>üíÄ ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏´‡∏±‡∏î‡∏Ç‡∏±‡∏ö</span>";
        }

        const grid = document.getElementById('analysisGrid');
        let html = '';
        for (const level in stats) {
            const data = stats[level];
            const percent = data.total > 0 ? (data.correct / data.total) * 100 : 0;
            
            // Logic for Recommendation/Advice
            let advice = "";
            if(percent === 100) {
                advice = "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏•‡∏¢";
            } else if (percent >= 50) {
                advice = "‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢";
            } else {
                if(level === 'Easy') advice = "‚ùó ‡∏Ñ‡∏ß‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô!";
                else if(level === 'Medium') advice = "‚ö†Ô∏è ‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô";
                else advice = "üî• ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏¢‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡πâ‡∏≠‡∏ô‡∏∞!";
            }

            html += `
            <div class="analysis-card">
                <div>
                    <div style="font-weight:800; color:${data.color}; letter-spacing:1px;">${data.label}</div>
                    <div style="font-size:0.9rem; margin-bottom:5px; color:#ccc;">‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${data.correct}/${data.total} ‡∏Ç‡πâ‡∏≠</div>
                    <div class="stat-bar-bg">
                        <div class="stat-bar-fill" style="width:${percent}%; background-color:${data.color}; box-shadow: 0 0 10px ${data.color};"></div>
                    </div>
                </div>
                <div class="advice-text" style="border-left-color:${data.color};">
                    üí° ${advice}
                </div>
            </div>`;
        }
        grid.innerHTML = html;
    }

    // --- Simple Confetti Logic (Vanilla JS) ---
    function fireConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const pieces = [];
        const numberOfPieces = 150;
        const colors = ['#00f2ea', '#ff0050', '#ffb700', '#ffffff'];

        for (let i = 0; i < numberOfPieces; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                rotation: Math.random() * 360,
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 10 + 5,
                speed: Math.random() * 5 + 2,
                opacity: 1
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            pieces.forEach((p, i) => {
                ctx.globalAlpha = p.opacity;
                ctx.fillStyle = p.color;
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                ctx.restore();

                p.y += p.speed;
                p.rotation += 2;

                if (p.y > canvas.height) {
                    p.y = -20; 
                    if(Math.random() > 0.9) p.opacity = 0; // Fade out eventually
                }
            });
            requestAnimationFrame(draw);
        }
        draw();
        
        // Stop after 5 seconds to save performance
        setTimeout(() => {
            const clearId = setInterval(() => {
                pieces.forEach(p => p.opacity -= 0.05);
                if(pieces[0].opacity <= 0) {
                    clearInterval(clearId);
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }, 50);
        }, 5000);
    }
</script>

</body>
</html>
