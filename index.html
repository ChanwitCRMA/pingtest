<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Master Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --accent-color: #ff0080;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.5);
            --text-color: #2d3436;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            color: var(--text-color);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Container & Glass Effect */
        .container {
            width: 95%;
            max-width: 900px;
            height: 90vh;
            background: var(--glass-bg);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Screens */
        .screen {
            flex: 1;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            animation: fadeIn 0.4s ease;
        }
        
        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Typography */
        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: -webkit-linear-gradient(45deg, #0984e3, #d63031);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle { font-size: 1.1rem; color: #636e72; margin-bottom: 30px; }

        /* Inputs & Buttons */
        input[type="text"], input[type="number"] {
            width: 100%;
            max-width: 350px;
            padding: 12px 20px;
            border-radius: 50px;
            border: 2px solid #dfe6e9;
            font-size: 1.1rem;
            text-align: center;
            outline: none;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
            background: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
        }

        input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.3);
        }

        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:active { transform: scale(0.95); }

        .btn-primary {
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(to right, #eb3349, #f45c43);
            color: white;
        }

        .btn-secondary {
            background: white;
            color: #636e72;
            border: 2px solid #dfe6e9;
        }

        /* Top Bar */
        .top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            box-sizing: border-box;
            z-index: 10;
        }

        .timer-box {
            font-size: 1.2rem;
            font-weight: bold;
            color: #d63031;
            background: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #fab1a0;
            display: flex;
            align-items: center;
            min-width: 80px;
            justify-content: center;
        }
        
        .finish-icon-btn {
            cursor: pointer;
            font-size: 1.5rem;
            padding: 5px 10px;
            border-radius: 10px;
            background: #ffeaa7;
            margin-left: 10px;
            border: none;
        }

        /* Question Area */
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: #dfe6e9;
            position: absolute;
            top: 0; left: 0;
        }
        .progress-bar-fill {
            height: 100%;
            background: #00cec9;
            width: 0%;
            transition: width 0.3s;
        }

        .question-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            width: 90%;
            max-width: 700px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .question-badge {
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .badge-easy { background: #eafaf1; color: #27ae60; }
        .badge-medium { background: #fef5e7; color: #d35400; }
        .badge-hard { background: #fdedec; color: #c0392b; }

        .question-text {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #2d3436;
        }

        .input-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 15px;
            gap: 10px;
        }

        /* Modal Styles (Custom Confirm) */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 20px;
            text-align: center; width: 90%; max-width: 400px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Analysis Grid */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }
        .analysis-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: left;
            border: 1px solid #eee;
        }
        .stat-bar-bg { height: 8px; background: #dfe6e9; border-radius: 4px; overflow: hidden; margin-top:5px;}
        .stat-bar-fill { height: 100%; background: #0984e3; border-radius: 4px; }
        
        .score-circle {
            width: 120px; height: 120px;
            border-radius: 50%;
            border: 6px solid #00cec9;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: bold; color: #00cec9;
            margin: 10px auto;
        }

        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .question-text { font-size: 1.1rem; }
            .top-bar { padding: 10px; }
            .btn { width: 100%; margin: 5px 0; }
            .nav-buttons { flex-direction: column-reverse; }
        }
    </style>
</head>
<body>

<!-- Custom Modal for Confirmation -->
<div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="margin-top:0;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö?</h2>
        <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏•‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
            <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á</button>
            <button class="btn btn-danger" onclick="confirmFinish()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
        </div>
    </div>
</div>

<!-- Custom Modal for Time Up -->
<div id="timeUpModal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="color:#d63031; margin-top:0;">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h2>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
        <button class="btn btn-primary" onclick="confirmFinish()">‡∏î‡∏π‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>
</div>

<div class="container">
    <div class="progress-bar-container">
        <div id="globalProgress" class="progress-bar-fill"></div>
    </div>

    <!-- 1. Start Screen -->
    <div id="start-screen" class="screen active">
        <h1>PHYSICS MASTER</h1>
        <div class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏Å‡∏• | 15 ‡∏Ç‡πâ‡∏≠ | 30 ‡∏ô‡∏≤‡∏ó‡∏µ</div>
        
        <div style="width: 100%; max-width: 400px;">
            <label style="display:block; text-align:left; margin-bottom: 5px; font-weight:bold; color:#636e72;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö</label>
            <input type="text" id="studentName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." autocomplete="off">
            <button class="btn btn-primary" style="width: 100%; margin-top:10px;" onclick="startQuiz()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
        </div>
    </div>

    <!-- 2. Quiz Screen -->
    <div id="quiz-screen" class="screen" style="justify-content: flex-start; padding-top: 60px;">
        <div class="top-bar" style="position: absolute; top:0; left:0;">
            <div style="font-weight:bold; font-size:0.9rem;">
                üë§ <span id="displayStudentName">Guest</span>
            </div>
            <div style="display:flex; align-items:center;">
                <div class="timer-box">
                    ‚è± <span id="timer">30:00</span>
                </div>
                <!-- Quick Submit Button -->
                <button class="finish-icon-btn" title="‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" onclick="requestSubmit()">üèÅ</button>
            </div>
        </div>

        <div class="question-card">
            <div id="questionBadge" class="question-badge badge-easy">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢</div>
            <div style="color:#b2bec3; font-size:0.9rem; margin-bottom:5px;">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà <span id="currentQNum">1</span> / 15</div>
            <div id="questionText" class="question-text">Loading...</div>
            
            <div class="input-area">
                <input type="number" id="answerInput" step="any" placeholder="‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö" onkeydown="checkEnter(event)">
                <span id="unitLabel" style="font-weight:bold; color:#636e72;">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
            </div>
        </div>

        <div class="nav-buttons">
            <button id="btnPrev" class="btn btn-secondary" onclick="prevQuestion()" style="flex:1;">‚ùÆ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button id="btnNext" class="btn btn-primary" onclick="nextQuestion()" style="flex:1;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ùØ</button>
            <button id="btnSubmit" class="btn btn-danger" onclick="requestSubmit()" style="flex:1; display: none;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
        </div>
    </div>

    <!-- 3. Result Screen -->
    <div id="result-screen" class="screen">
        <div style="width:100%; max-width:700px; padding-bottom:40px;">
            <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</h2>
            <div id="resultStudentName" style="color:#636e72;"></div>
            
            <div class="score-circle">
                <div><span id="finalScore">0</span><span style="font-size:1.2rem; color:#b2bec3;">/15</span></div>
            </div>
            
            <div id="passFailMsg" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 20px;"></div>

            <h3>‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•</h3>
            <div class="analysis-grid" id="analysisGrid"></div>

            <button class="btn btn-secondary" onclick="location.reload()" style="margin-top: 30px; width:100%;">‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>

</div>

<script>
    // --- Database ---
    const poolQuestions = [
        // Easy
        { level: "Easy", text: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 50 ‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô ‡∏ú‡∏•‡∏±‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏£‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ (‡∏à‡∏π‡∏•)", answer: 500, unit: "J" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 2 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 10 m/s ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå (‡∏à‡∏π‡∏•)", answer: 100, unit: "J" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 10 kg ‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á (‡∏à‡∏π‡∏•)", answer: 500, unit: "J" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ï‡∏Å‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏∂‡∏Å‡∏™‡∏π‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (m/s)", answer: 20, unit: "m/s" },
        { level: "Easy", text: "‡πÅ‡∏Å‡∏ß‡πà‡∏á‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 0.8 ‡πÄ‡∏°‡∏ï‡∏£ (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î) ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (m/s)", answer: 4, unit: "m/s" },
        { level: "Easy", text: "‡πÇ‡∏¢‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡πâ‡∏ô 30 m/s ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£", answer: 45, unit: "m" },
        { level: "Easy", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÑ‡∏ñ‡∏•‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏•‡∏∑‡πà‡∏ô‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (m/s)", answer: 10, unit: "m/s" },
        // Medium
        { level: "Medium", text: "‡∏£‡∏ñ‡πÑ‡∏ü‡πÄ‡∏´‡∏≤‡∏∞‡∏°‡∏ß‡∏• 500 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î A ‡∏™‡∏π‡∏á 25 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏•‡∏á‡∏°‡∏≤‡∏¢‡∏±‡∏á‡∏à‡∏∏‡∏î B ‡∏™‡∏π‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î B ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà A)", answer: 20, unit: "m/s" },
        { level: "Medium", text: "‡∏™‡∏õ‡∏£‡∏¥‡∏á (k=800 N/m) ‡∏ñ‡∏π‡∏Å‡∏Å‡∏î‡∏´‡∏î 0.1 m ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏à‡∏∞‡∏î‡∏µ‡∏î‡∏°‡∏ß‡∏• 2 kg ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", answer: 2, unit: "m/s" },
        { level: "Medium", text: "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏°‡∏ß‡∏• 1,000 kg ‡∏ß‡∏¥‡πà‡∏á 20 m/s ‡πÄ‡∏ö‡∏£‡∏Å‡∏à‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏ô 100 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏ï‡πâ‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô)", answer: 2000, unit: "N" },
        { level: "Medium", text: "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏°‡∏ß‡∏• 5 kg ‡πÑ‡∏ñ‡∏•‡∏•‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏π‡∏á 4 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏¢‡∏≤‡∏ß 10 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏≠‡∏î‡∏µ ‡∏à‡∏á‡∏´‡∏≤‡πÅ‡∏£‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏ô (‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô)", answer: 20, unit: "N" },
        { level: "Medium", text: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏°‡∏ß‡∏• 4 kg ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5 m/s ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏ô‡∏™‡∏õ‡∏£‡∏¥‡∏á (k=400 N/m) ‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏´‡∏î‡∏ï‡∏±‡∏ß‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£", answer: 0.5, unit: "m" },
        // Hard
        { level: "Hard", text: "‡∏Å‡∏î‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏´‡∏î‡∏•‡∏á 0.2 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏µ‡∏î‡∏°‡∏ß‡∏• 0.5 kg ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏î‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ k ‡∏Ç‡∏≠‡∏á‡∏™‡∏õ‡∏£‡∏¥‡∏á (N/m)", answer: 1000, unit: "N/m" },
        { level: "Hard", text: "‡∏ö‡∏•‡πá‡∏≠‡∏Å 2 kg ‡∏≠‡∏±‡∏î‡∏™‡∏õ‡∏£‡∏¥‡∏á (k=1000) ‡∏´‡∏î 0.2 m ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏û‡∏∏‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£ (‡πÅ‡∏ô‡∏ß‡∏î‡∏¥‡πà‡∏á)", answer: 1, unit: "m" },
        { level: "Hard", text: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏∂‡∏Å‡∏™‡∏π‡∏á 25 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡πâ‡∏ô 20 m/s ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏à‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î (m/s)", answer: 30, unit: "m/s" }
    ];

    // --- State ---
    let quizQuestions = [];
    let userAnswers = [];
    let currentQIndex = 0;
    let timerInterval;
    let timeRemaining = 30 * 60;

    // --- Core Logic ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz() {
        const name = document.getElementById('studentName').value.trim();
        if(!name) {
            // Use simple alert just for initial validation if needed, or simple focus
            document.getElementById('studentName').style.borderColor = "red";
            document.getElementById('studentName').focus();
            return;
        }

        document.getElementById('displayStudentName').innerText = name;
        
        // Prepare questions
        const easyQ = shuffleArray(poolQuestions.filter(q => q.level === 'Easy'));
        const mediumQ = shuffleArray(poolQuestions.filter(q => q.level === 'Medium'));
        const hardQ = shuffleArray(poolQuestions.filter(q => q.level === 'Hard'));
        
        quizQuestions = [...easyQ, ...mediumQ, ...hardQ];
        userAnswers = new Array(quizQuestions.length).fill(null);

        // UI Transition
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');

        currentQIndex = 0;
        renderQuestion();
        startTimer();
    }

    function startTimer() {
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay();
            
            if(timeRemaining <= 0) {
                clearInterval(timerInterval);
                document.getElementById('timeUpModal').style.display = 'flex';
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        const timerEl = document.getElementById('timer');
        timerEl.innerText = display;
        
        // Progress bar global
        const percent = ((30*60 - timeRemaining) / (30*60)) * 100;
        // Optional: animate global background or similar
    }

    // --- Rendering ---
    function renderQuestion() {
        const q = quizQuestions[currentQIndex];
        
        // Badge
        const badge = document.getElementById('questionBadge');
        badge.className = 'question-badge';
        if(q.level === 'Easy') { badge.classList.add('badge-easy'); badge.innerText = "‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢"; }
        else if(q.level === 'Medium') { badge.classList.add('badge-medium'); badge.innerText = "‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á"; }
        else { badge.classList.add('badge-hard'); badge.innerText = "‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏¢‡∏≤‡∏Å"; }

        document.getElementById('currentQNum').innerText = currentQIndex + 1;
        document.getElementById('questionText').innerText = q.text;
        document.getElementById('unitLabel').innerText = q.unit;

        // Input
        const input = document.getElementById('answerInput');
        input.value = userAnswers[currentQIndex] !== null ? userAnswers[currentQIndex] : '';
        input.focus();

        // Buttons
        document.getElementById('btnPrev').style.visibility = currentQIndex === 0 ? 'hidden' : 'visible';
        
        if (currentQIndex === quizQuestions.length - 1) {
            document.getElementById('btnNext').style.display = 'none';
            document.getElementById('btnSubmit').style.display = 'block';
        } else {
            document.getElementById('btnNext').style.display = 'block';
            document.getElementById('btnSubmit').style.display = 'none';
        }

        // Top Progress Bar
        const progress = ((currentQIndex + 1) / quizQuestions.length) * 100;
        document.getElementById('globalProgress').style.width = `${progress}%`;
    }

    function saveCurrentAnswer() {
        const input = document.getElementById('answerInput');
        if(input.value !== '') {
            userAnswers[currentQIndex] = parseFloat(input.value);
        } else {
            userAnswers[currentQIndex] = null;
        }
    }

    function nextQuestion() {
        saveCurrentAnswer();
        if(currentQIndex < quizQuestions.length - 1) {
            currentQIndex++;
            renderQuestion();
        }
    }

    function prevQuestion() {
        saveCurrentAnswer();
        if(currentQIndex > 0) {
            currentQIndex--;
            renderQuestion();
        }
    }

    function checkEnter(e) {
        if(e.key === 'Enter') {
            if(currentQIndex < quizQuestions.length - 1) {
                nextQuestion();
            } else {
                requestSubmit();
            }
        }
    }

    // --- Modal & Submit Logic ---
    function requestSubmit() {
        saveCurrentAnswer();
        // Show custom modal
        document.getElementById('confirmModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('confirmModal').style.display = 'none';
    }

    function confirmFinish() {
        clearInterval(timerInterval);
        document.getElementById('confirmModal').style.display = 'none';
        document.getElementById('timeUpModal').style.display = 'none';
        
        calculateResults();
        
        // Switch Screen
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
    }

    function calculateResults() {
        let score = 0;
        let stats = {
            Easy: { total: 0, correct: 0, label: "‡∏á‡πà‡∏≤‡∏¢" },
            Medium: { total: 0, correct: 0, label: "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á" },
            Hard: { total: 0, correct: 0, label: "‡∏¢‡∏≤‡∏Å" }
        };

        quizQuestions.forEach((q, i) => {
            const userAns = userAnswers[i];
            // Check correctness (tolerance 0.01)
            const isCorrect = userAns !== null && Math.abs(userAns - q.answer) < 0.01;
            
            stats[q.level].total++;
            if(isCorrect) {
                score++;
                stats[q.level].correct++;
            }
        });

        document.getElementById('resultStudentName').innerText = "‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö: " + document.getElementById('studentName').value;
        document.getElementById('finalScore').innerText = score;

        // Feedback
        const msgDiv = document.getElementById('passFailMsg');
        const percentage = (score / quizQuestions.length) * 100;
        if(percentage >= 80) {
            msgDiv.innerHTML = "<span style='color:#00b894'>üåü ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏°‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå (Master)</span>";
        } else if (percentage >= 50) {
            msgDiv.innerHTML = "<span style='color:#fdcb6e'>üëç ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå (Passed)</span>";
        } else {
            msgDiv.innerHTML = "<span style='color:#d63031'>üí™ ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î (Keep Trying)</span>";
        }

        // Analysis Grid
        const grid = document.getElementById('analysisGrid');
        let html = '';
        for (const level in stats) {
            const data = stats[level];
            const percent = data.total > 0 ? (data.correct / data.total) * 100 : 0;
            let barColor = percent >= 80 ? '#00b894' : (percent >= 50 ? '#fdcb6e' : '#ff7675');
            
            html += `
            <div class="analysis-card">
                <div style="font-weight:bold; color:#636e72;">‡∏£‡∏∞‡∏î‡∏±‡∏ö${data.label}</div>
                <div style="font-size:0.9rem; margin-bottom:5px;">‡πÑ‡∏î‡πâ ${data.correct}/${data.total} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                <div class="stat-bar-bg">
                    <div class="stat-bar-fill" style="width:${percent}%; background-color:${barColor};"></div>
                </div>
            </div>`;
        }
        grid.innerHTML = html;
    }
</script>

</body>
</html>
